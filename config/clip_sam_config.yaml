# CLIP+SAMè¯­ä¹‰å»ºå›¾é…ç½®- ä¸“æ³¨äºéšœç¢ç‰©+å®¶å…·+æˆ¿é—´å¯é åˆ’åˆ†
# åŒ¹é…/home/robot/catkin_ws/src/slam_pkg/launch/gmapping.launch

# âœ¨ æ¨ç†é…ç½®
inference:
  structure_detection:
    enable: false  # âœ… ç¦ç”¨ Structure æ£€æµ‹ï¼ˆå‡†ç¡®ç‡ä½ï¼ŒSLAM å·²æœ‰ï¼‰
  furniture_detection:
    enable: true

# CLIPæ¨¡å‹é…ç½®
clip:
  model_name: "ViT-B/32"
  device: "auto"
  confidence_threshold: 0.25  # é™ä½é˜ˆå€¼ï¼Œæé«˜æ•æ„Ÿåº¦

# SAMæ¨¡å‹é…ç½®  
sam:
  model_type: "vit_b"
  checkpoint_path: "./models/sam_vit_b_01ec64.pth"
  device: "auto"
  points_per_side: 16  # å¢åŠ å¯†åº¦ï¼Œæ›´å¥½åœ°åˆ†å‰²ç‰©ä½“
  pred_iou_thresh: 0.65
  stability_score_thresh: 0.75  # ç¨³å®šæ€§é˜ˆå€¼
  crop_n_layers: 1  # æ–°å¢ï¼šå¤šå°ºåº¦è£å‰ªå±‚æ•°
  crop_n_points_downscale_factor: 2  # æ–°å¢ï¼šè£å‰ªç‚¹ä¸‹é‡‡æ ·å› å­

# ğŸ æˆ¿é—´ç±»å‹- ä¿æŒæ‚¨çš„åŸæœ‰é…ç½®
# room_types:
#   chinese: ["å®¢å…", "å§å®¤", "å¨æˆ¿", "å«ç”Ÿé—´", "é˜³å°", "ä¹¦æˆ¿", "é¤å…", "ç„å…³"]
#   english: ["living room", "bedroom", "kitchen", "bathroom", "balcony", "study", "dining room", "entrance"]
#   codes:
#     "å®¢å…": 10
#     "å§å®¤": 20  
#     "å¨æˆ¿": 30
#     "å«ç”Ÿé—´": 40
#     "é˜³å°": 50
#     "ä¹¦æˆ¿": 60
#     "é¤å…": 70
#     "ç„å…³": 80
#     "æœªçŸ¥": 5
#   colors:
#     "å®¢å…": [0, 255, 0]
#     "å§å®¤": [255, 0, 0]
#     "å¨æˆ¿": [0, 0, 255]
#     "å«ç”Ÿé—´": [255, 255, 0]
#     "é˜³å°": [255, 0, 255]
#     "ä¹¦æˆ¿": [0, 255, 255]
#     "é¤å…": [255, 128, 0]
#     "ç„å…³": [128, 255, 0]
#     "æœªçŸ¥": [128, 128, 128]
room_types:
  chinese: ["å®¢å…", "å§å®¤", "ä¹¦æˆ¿", "é¤å…"]
  english: ["living room", "bedroom", "study", "dining room"]
  codes:
    "å®¢å…": 10
    "å§å®¤": 20  
    "ä¹¦æˆ¿": 60
    "é¤å…": 70
    "æœªçŸ¥": 5
  colors:
    "å®¢å…": [0, 255, 0]
    "å§å®¤": [255, 0, 0]
    "ä¹¦æˆ¿": [0, 255, 255]
    "é¤å…": [255, 128, 0]
    "æœªçŸ¥": [128, 128, 128]

# ğŸª‘ å®¶å…·ç‰©å“è¯­ä¹‰åˆ†ç±»- ä¸“æ³¨äºå®¶å±…ç¯å¢ƒ
# ğŸª‘ å®¶å…·ç‰©å“è¯­ä¹‰åˆ†ç±» - ä¿®æ­£ç¼–ç èŒƒå›´
# furniture_objects:
#   # å¤§å‹å®¶å…· (50-59)
#   large_furniture:
#     chinese: ["æ²™å‘", "åºŠ", "è¡£æŸœ", "ä¹¦æŸœ", "é¤æ¡Œ", "èŒ¶å‡ ", "ç”µè§†æŸœ"]
#     english: ["sofa", "bed", "wardrobe", "bookshelf", "dining table", "coffee table", "tv stand"]
#     codes: {"æ²™å‘": 50, "åºŠ": 51, "è¡£æŸœ": 52, "ä¹¦æŸœ": 53, "é¤æ¡Œ": 54, "èŒ¶å‡ ": 55, "ç”µè§†æŸœ": 56}
#     colors: {"æ²™å‘": [139, 69, 19], "åºŠ": [160, 82, 45], "è¡£æŸœ": [205, 133, 63], "ä¹¦æŸœ": [222, 184, 135], 
#              "é¤æ¡Œ": [244, 164, 96], "èŒ¶å‡ ": [210, 180, 140], "ç”µè§†æŸœ": [188, 143, 143]}
  
#   # ä¸­å‹å®¶å…· (60-69)
#   medium_furniture:
#     chinese: ["æ¤…å­", "å‡³å­", "æ¡Œå­", "åŠå…¬æ¡Œ", "æ¢³å¦†å°", "é‹æŸœ"]
#     english: ["chair", "stool", "table", "desk", "dressing table", "shoe cabinet"]
#     codes: {"æ¤…å­": 60, "å‡³å­": 61, "æ¡Œå­": 62, "åŠå…¬æ¡Œ": 63, "æ¢³å¦†å°": 64, "é‹æŸœ": 65}
#     colors: {"æ¤…å­": [255, 140, 0], "å‡³å­": [255, 165, 0], "æ¡Œå­": [255, 215, 0], 
#              "åŠå…¬æ¡Œ": [240, 230, 140], "æ¢³å¦†å°": [255, 218, 185], "é‹æŸœ": [245, 222, 179]}
  
#   # å®¶ç”µè®¾å¤‡ (70-79)
#   appliances:
#     chinese: ["ç”µè§†", "å†°ç®±", "æ´—è¡£æœº", "ç©ºè°ƒ", "å¾®æ³¢ç‚‰", "çƒ­æ°´å™¨"]
#     english: ["television", "refrigerator", "washing machine", "air conditioner", "microwave", "water heater"]
#     codes: {"ç”µè§†": 70, "å†°ç®±": 71, "æ´—è¡£æœº": 72, "ç©ºè°ƒ": 73, "å¾®æ³¢ç‚‰": 74, "çƒ­æ°´å™¨": 75}
#     colors: {"ç”µè§†": [70, 130, 180], "å†°ç®±": [100, 149, 237], "æ´—è¡£æœº": [123, 104, 238], 
#              "ç©ºè°ƒ": [147, 112, 219], "å¾®æ³¢ç‚‰": [138, 43, 226], "çƒ­æ°´å™¨": [106, 90, 205]}
furniture_objects:
  # å¤§å‹å®¶å…· (50-59)
  large_furniture:
    chinese: ["æ²™å‘", "åºŠ", "ä¹¦æŸœ", "é¤æ¡Œ", "èŒ¶å‡ ", "ç”µè§†æŸœ"]
    english: ["sofa", "bed", "bookshelf", "dining table", "coffee table", "tv stand"]
    codes: {"æ²™å‘": 50, "åºŠ": 51, "ä¹¦æŸœ": 53, "é¤æ¡Œ": 54, "èŒ¶å‡ ": 55, "ç”µè§†æŸœ": 56}
    colors: {"æ²™å‘": [139, 69, 19], "åºŠ": [160, 82, 45], "ä¹¦æŸœ": [222, 184, 135], 
             "é¤æ¡Œ": [244, 164, 96], "èŒ¶å‡ ": [210, 180, 140], "ç”µè§†æŸœ": [188, 143, 143]}
  
  # ä¸­å‹å®¶å…· (60-69)
  medium_furniture:
    chinese: ["æ¤…å­", "æ¡Œå­", "åŠå…¬æ¡Œ", "é‹æŸœ"]
    english: ["chair", "table", "desk", "shoe cabinet"]
    codes: {"æ¤…å­": 60, "æ¡Œå­": 62, "é‹æŸœ": 65}
    colors: {"æ¤…å­": [255, 140, 0], "æ¡Œå­": [255, 215, 0], 
             "é‹æŸœ": [245, 222, 179]}
  
  # # å®¶ç”µè®¾å¤‡ (70-79)
  # appliances:
  #   chinese: ["ç”µè§†", "å†°ç®±", "æ´—è¡£æœº", "ç©ºè°ƒ", "å¾®æ³¢ç‚‰", "çƒ­æ°´å™¨"]
  #   english: ["television", "refrigerator", "washing machine", "air conditioner", "microwave", "water heater"]
  #   codes: {"ç”µè§†": 70, "å†°ç®±": 71, "æ´—è¡£æœº": 72, "ç©ºè°ƒ": 73, "å¾®æ³¢ç‚‰": 74, "çƒ­æ°´å™¨": 75}
  #   colors: {"ç”µè§†": [70, 130, 180], "å†°ç®±": [100, 149, 237], "æ´—è¡£æœº": [123, 104, 238], 
  #            "ç©ºè°ƒ": [147, 112, 219], "å¾®æ³¢ç‚‰": [138, 43, 226], "çƒ­æ°´å™¨": [106, 90, 205]}

# ğŸ§± éšœç¢ç‰©å’Œç»“æ„å…ƒç´  - ä¿®æ­£ç¼–ç èŒƒå›´
structural_elements:
  # å›ºå®šç»“æ„ (80-89)
  fixed_structures:
    chinese: ["å¢™å£", "æŸ±å­", "å°é˜¶", "æ¥¼æ¢¯", "æ æ†", "çª—æˆ·", "é—¨"]
    english: ["wall", "pillar", "step", "stairs", "railing", "window", "door"]
    codes: {"å¢™å£": 80, "æŸ±å­": 81, "å°é˜¶": 82, "æ¥¼æ¢¯": 83, "æ æ†": 84, "çª—æˆ·": 85, "é—¨": 86}
    colors: {"å¢™å£": [105, 105, 105], "æŸ±å­": [119, 136, 153], "å°é˜¶": [128, 128, 128], 
             "æ¥¼æ¢¯": [169, 169, 169], "æ æ†": [192, 192, 192], "çª—æˆ·": [211, 211, 211], "é—¨": [220, 220, 220]}
  
  # åœ°é¢å…ƒç´  (90-99)
  floor_elements:
    chinese: ["åœ°æ¿", "åœ°æ¯¯", "ç“·ç –", "é—¨æ§›", "åœ°å«"]
    english: ["floor", "carpet", "tile", "threshold", "mat"]
    codes: {"åœ°æ¿": 90, "åœ°æ¯¯": 91, "ç“·ç –": 92, "é—¨æ§›": 93, "åœ°å«": 94}
    colors: {"åœ°æ¿": [205, 192, 176], "åœ°æ¯¯": [188, 143, 143], "ç“·ç –": [245, 245, 220], 
             "é—¨æ§›": [139, 134, 130], "åœ°å«": [160, 160, 160]}



# ğŸ¤–WPRä»¿çœŸç¯å¢ƒROSè¯é¢˜é…ç½®
ros_topics:
  input_image: "/kinect2/qhd/image_color_rect"
  input_laser: "/scan"
  input_map: "/map"
  # æ–°å¢æ·±åº¦ä¿¡æ¯(å¦‚æœå¯ç”¨)
  input_depth: "/kinect2/qhd/image_depth_rect"
  
  output_semantic_label: "/semantic_label"
  output_semantic_map: "/semantic_occupancy_grid"
  output_semantic_image: "/semantic_map_image"
  output_inference_info: "/semantic_inference_info"
  # æ–°å¢åˆ†å±‚è¯­ä¹‰è¾“å‡º
  output_furniture_map: "/furniture_semantic_map"
  output_structure_map: "/structure_semantic_map"

# ğŸ§ æ¨ç†é…ç½®- å¤šå±‚æ¬¡è¯­ä¹‰åˆ†æ
inference:
  max_concurrent: 2  # æ”¯æŒå¹¶å‘å¤„ç†
  queue_size: 8
  image_change_threshold: 0.15  # é™ä½å˜åŒ–é˜ˆå€¼
  confidence_threshold: 0.5
  force_inference_interval: 1.5
  inference_interval: 0.08  # æé«˜æ¨ç†é¢‘ç‡
  
  # ğŸª‘ å®¶å…·æ£€æµ‹å‚æ•°
  furniture_detection:
    enable: true
    confidence_threshold: 0.5  # å®¶å…·æ£€æµ‹é˜ˆå€¼
    sam_enhancement: true  # å¯ç”¨SAMå¢å¼ºåˆ†å‰²
    size_filter_min: 200  # æœ€å°å®¶å…·åŒºåŸŸ(åƒç´ )
    size_filter_max: 50000  # æœ€å¤§å®¶å…·åŒºåŸŸ(åƒç´ )
  
  # ğŸ§± ç»“æ„æ£€æµ‹å‚æ•°  
  structure_detection:
    enable: true
    confidence_threshold: 0.5  # ç»“æ„æ£€æµ‹é˜ˆå€¼
    edge_enhancement: true  # è¾¹ç¼˜å¢å¼º
    morphology_filter: true  # å½¢æ€å­¦è¿‡æ»¤

# ğŸ¯WSL+Stageä»¿çœŸé…ç½®
simulation_config:
  environment: "wpr_stage_robocup"
  display_server: "X11"
  gpu_mode: "cpu_only"
  opencv_backend: "cpu"

# ğŸ“Šåœ°å›¾ä¿å­˜ - é€‚é…æ‚¨çš„é¡¹ç›®ç»“æ„
map_save:
  auto_save: true
  directory: "/home/robot/catkin_ws/src/clip_sam_semantic_mapping/results/semantic_maps"
  filename_format: "hierarchical_clip_sam_{timestamp}_{rooms}.png"
  save_room_map: true
  save_furniture_map: true
  save_structure_map: true
  save_combined_map: true
  
# ç»Ÿè®¡ä¿å­˜
statistics:
  save_stats: true
  stats_directory: "/home/robot/catkin_ws/src/clip_sam_semantic_mapping/results/analysis"
  log_directory: "/home/robot/catkin_ws/src/clip_sam_semantic_mapping/results/logs"

# ğŸ”§æ¿€å…‰é›·è¾¾æŠ•å°„å‚æ•°- ä¼˜åŒ–ç‰©ä½“æ£€æµ‹
laser_projection:
  range_min: 0.1
  range_max: 5.0
  angle_range: 75.0  # æ‰©å¤§è§’åº¦èŒƒå›´
  annotation_radius: 4  # å¢åŠ æ ‡æ³¨åŠå¾„
  # åˆ†å±‚æ ‡æ³¨å‚æ•°
  room_annotation_radius: 5  # æˆ¿é—´æ ‡æ³¨åŠå¾„
  furniture_annotation_radius: 3  # å®¶å…·æ ‡æ³¨åŠå¾„
  structure_annotation_radius: 2  # ç»“æ„æ ‡æ³¨åŠå¾„

# ğŸ¨æ˜¾ç¤ºé…ç½®
visualization:
  window_name: "Hierarchical CLIP+SAM Semantic Mapping - WPR Stage"
  font_scale: 0.7
  font_thickness: 2
  # åˆ†å±‚æ˜¾ç¤ºæ§åˆ¶
  show_room_overlay: true
  show_furniture_overlay: true  
  show_structure_overlay: true
  overlay_alpha: 0.6  # å åŠ é€æ˜åº¦
  
# ğŸ”§ CLIPæç¤ºè¯ä¼˜åŒ–
clip_prompts:
  # æˆ¿é—´è¯†åˆ«æç¤ºè¯å¢å¼º
  room_enhancement:
    enable: true
    context_templates:
      - "interior of a {room_type}"
      - "inside a {room_type}"
      - "{room_type} with furniture"
      - "residential {room_type}"
  
  # å®¶å…·è¯†åˆ«æç¤ºè¯
  furniture_enhancement:
    enable: true
    context_templates:
      - "furniture {object}"
      - "{object} in home"
      - "household {object}"
      - "residential {object}"
      - "{object} piece of furniture"
  
  # ç»“æ„è¯†åˆ«æç¤ºè¯
  structure_enhancement:
    enable: true
    context_templates:
      - "architectural {element}"
      - "building {element}"  
      - "interior {element}"
      - "structural {element}"

  # ğŸ“Œ æ¯ä¸ªæˆ¿é—´çš„ä¸“å±æç¤ºè¯ï¼ˆå¯è¦†ç›–ä¸Šé¢çš„é€šç”¨room_enhancementæ¨¡æ¿ï¼‰
  # è¯´æ˜ï¼šé”®ä½¿ç”¨ä¸­æ–‡æˆ¿é—´åï¼Œå€¼ä¸ºè¯¥æˆ¿é—´çš„å¤šæ¡æç¤ºè¯ï¼›é»˜è®¤ä½¿ç”¨ä¸ä¸Šé¢ç±»ä¼¼çš„æ¨¡æ¿ï¼Œä½†é’ˆå¯¹æˆ¿é—´åšäº†è½»é‡åŒ–å®šåˆ¶ã€‚
  per_room_prompts:
    "å®¢å…":
      - "interior of a living room"
      - "cozy living room with sofa and television"
      - "Two pale yellow sofas placed facing each other with a coffee table between them"
    # "å®¢å…":
    #   - "interior of a living room"
    #   - "cozy living room with sofa and television"
    #   - "living room with seating area and coffee table"
    #   - "residential living room with decorations"
    # "å§å®¤":
    #   - "interior of a bedroom"
    #   - "bedroom with a bed and wardrobe"
    #   - "sleeping room with bedside table and lamp"
    #   - "residential bedroom with linens and pillows"
    "å§å®¤":
      - "interior of a bedroom with bed as main furniture, not a living room, not a study"
      - "A bedroom with one bed and bedroom furniture"
      - "residential bedroom with bed, linens, pillows and nightstand"
      - "private bedroom interior with sleeping area"
    "ä¹¦æˆ¿":
      - "interior of a home office study room, not a dininng room"
      - "study room with desk, chair, and bookshelves"
      - "Two bookshelves with a desk and office chair in a study room"
      - "home office interior with books, desk, and reading area"
    "é¤å…":
      - "interior of a dining room, not a bedroom, not a study"
      - "dining room with many tables and chairs"
      - "residential dining area with table setting"

# ğŸ¯ SAMåˆ†å‰²ä¼˜åŒ–
sam_optimization:
  # å¤šå°ºåº¦åˆ†å‰²
  multi_scale:
    enable: true
    scales: [0.8, 1.0, 1.2]  # å¤šå°ºåº¦æ¯”ä¾‹
    
  # åŒºåŸŸåå¤„ç†
  post_processing:
    enable: true
    min_area_threshold: 100  # æœ€å°åŒºåŸŸé˜ˆå€¼
    max_area_threshold: 100000  # æœ€å¤§åŒºåŸŸé˜ˆå€¼
    hole_filling: true  # å­”æ´å¡«å……
    edge_smoothing: true  # è¾¹ç¼˜å¹³æ»‘
    
  # é®ç½©è´¨é‡è¿‡æ»¤
  mask_quality:
    iou_threshold: 0.7  # IoUé˜ˆå€¼
    stability_threshold: 0.8  # ç¨³å®šæ€§é˜ˆå€¼
    confidence_threshold: 0.75  # ç½®ä¿¡åº¦é˜ˆå€¼